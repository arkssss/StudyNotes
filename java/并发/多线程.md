# å¤šçº¿ç¨‹

[TOC]

## ä¸€. è¿›ç¨‹å’Œçº¿ç¨‹

### è¿›ç¨‹

è¿›ç¨‹æ˜¯ **èµ„æºåˆ†é…** çš„åŸºæœ¬å•ä½

è¿›ç¨‹ä¸ç›´æ¥æ‰§è¡Œ, è€Œåªæ˜¯è·å¾—åˆ†é…è®¡ç®—æœºçš„ç›¸å…³èµ„æº



### çº¿ç¨‹

çº¿ç¨‹æ˜¯ **ç‹¬ç«‹è°ƒåº¦** çš„åŸºæœ¬å•ä½

è€Œçº¿ç¨‹æ˜¯åœ¨è¿›ç¨‹çš„èµ„æºä¸Šè¿›è¡Œç›´æ¥æ‰§è¡Œçš„ä¸€ä¸ªåŸºæœ¬æ§åˆ¶å•å…ƒ, ä¹Ÿå¯ä»¥è¢«ç§°ä¸º **æ‰§è¡Œæƒ…æ™¯**, **æ‰§è¡Œè·¯å¾„**

ä¸€ä¸ªè¿›ç¨‹è‡³å°‘éœ€è¦åŒ…æ‹¬ä¸€ä¸ªçº¿ç¨‹, ä¹Ÿå¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹, å³å¤šä¸ªæ‰§è¡Œè·¯å¾„. ä¸”å¤šä¸ªæ‰§è¡Œè·¯å¾„å¯ä»¥**å¹¶å‘æ‰§è¡Œ**



![img](https://camo.githubusercontent.com/a66819fd82c6adfa69b368edf3c52b1fa9cdc89d/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d332f4a564de8bf90e8a18ce697b6e695b0e68daee58cbae59f9f2e706e67)



* ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹
* å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«è¿›ç¨‹çš„ **æ–¹æ³•åŒº** , **å †åŒº**
* æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±ç§æœ‰çš„ **VM æ ˆ** , **æœ¬åœ°æ–¹æ³•æ ˆ**, **PC**

**æ€»ç»“ï¼š** çº¿ç¨‹ æ˜¯ è¿›ç¨‹ åˆ’åˆ†æˆçš„æ›´å°çš„è¿è¡Œå•ä½ã€‚çº¿ç¨‹å’Œè¿›ç¨‹æœ€å¤§çš„ä¸åŒåœ¨äºåŸºæœ¬ä¸Šå„è¿›ç¨‹æ˜¯ **ç‹¬ç«‹** çš„ï¼Œè€Œå„çº¿ç¨‹åˆ™ä¸ä¸€å®šï¼Œå› ä¸ºåŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹ææœ‰å¯èƒ½ä¼šç›¸äº’å½±å“ã€‚çº¿ç¨‹æ‰§è¡Œå¼€é”€å°ï¼Œä½†ä¸åˆ©äºèµ„æºçš„ç®¡ç†å’Œä¿æŠ¤ï¼›è€Œè¿›ç¨‹æ­£ç›¸å 

* è¿›ç¨‹èµ„æºç‹¬ç«‹æ˜“ä¿æŠ¤
* çº¿ç¨‹å…±äº«å¼€é”€å°, éš¾ç»´æŠ¤











## äºŒ. ä½¿ç”¨çº¿ç¨‹

### åˆ›å»º å¹¶ å¯åŠ¨çº¿ç¨‹

åœ¨javaä¸­ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å…±æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹æ³• : 

* å®ç° Runnable æ¥å£
* å®ç° Callable æ¥å£
* ç»§æ‰¿ Thread ç±»

å®ç° Runnable å’Œ Callable æ¥å£çš„ç±»åªèƒ½å½“åšä¸€ä¸ªå¯ä»¥åœ¨çº¿ç¨‹ä¸­è¿è¡Œçš„ä»»åŠ¡ï¼Œä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„çº¿ç¨‹ï¼Œå› æ­¤æœ€åè¿˜éœ€è¦é€šè¿‡ Thread æ¥è°ƒç”¨ã€‚å¯ä»¥è¯´ä»»åŠ¡æ˜¯é€šè¿‡çº¿ç¨‹é©±åŠ¨ä»è€Œæ‰§è¡Œçš„ã€‚

 





#### ç»§æ‰¿ Thread ç±»çš„æ–¹å¼ä½¿ç”¨çº¿ç¨‹

å…¶å® Thread ç±»ä¹Ÿæ˜¯ Runnable çš„ä¸€ä¸ª Impls

~~~java
class Thread extends object implements Runnable{}
~~~

<hr>

ç¬¬ä¸€æ­¥ : å®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿ Tread ç±»:

~~~java
/*
	java æ ¸å¿ƒè¯­è¨€åŒ… lang ä¸­å°è£…äº† thread ç±»
	è¿™ä¸ªç±»å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹
	
*/
class MyThread extends Thread{
    // code ..
}    
/*
	ä½¿ç”¨æ—¶, æˆ‘ä»¬ç›´æ¥å®ä¾‹åŒ–è¿™ä¸ªç±», å†è°ƒç”¨ä¸‹é¢ä»‹ç»çš„æ–¹æ³•å³å¯
*/
~~~

<hr>



ç¬¬äºŒæ­¥ : **è¦†ç›–** Thread ç±»ä¸­çš„ run æ–¹æ³•

å®šä¹‰ä¸€ä¸ªæ–°çš„çº¿ç¨‹çš„ç›®çš„å°±æ˜¯ä¸ºäº† : è®©çº¿ç¨‹å»å¸®åŠ©æˆ‘ä»¬çš„å¹¶è¡Œçš„è¿è¡Œè®¡ç®—ä¸€äº›ä»»åŠ¡

Thread ç±»é‡Œé¢æä¾›äº† ä¸€ä¸ªæ–¹æ³• run()

~~~java
/*
	run() æ–¹æ³•
	æˆ‘ä»¬éœ€è¦åœ¨å­ç±»é‡Œé¢é‡å†™è¿™ä¸ª run æ–¹æ³•, ä»è€Œå®ç°æˆ‘ä»¬è‡ªå®šä¹‰åŠŸèƒ½çš„ç›®çš„
*/
class MyThread extends Thread{
    
    public void run(){
        // your function here
    }
    
    /*
     ç‰¹åˆ«æ³¨æ„, çˆ¶ç±»çš„runæ–¹æ³• å‚æ•°åˆ—è¡¨ä¸ºç©º
     æ‰€ä»¥æˆ‘ä»¬é‡å†™(è¦†ç›–)çš„æ—¶å€™, ä¸è¦æ·»åŠ æ–°çš„å‚æ•°åˆ—è¡¨
     å¦åˆ™ ä¾¿æ˜¯ä¸€ä¸ªæ–°çš„runæ–¹æ³•, è€Œä¸æ˜¯é‡å†™äº†
     
     âŒ
     public void run(int i){

      }
      
    */
}   
~~~



<hr>

ç¬¬ä¸‰æ­¥ : å¯åŠ¨çº¿ç¨‹

æˆ‘ä»¬å¯åŠ¨çº¿ç¨‹, åªéœ€è¦å°†å®ä¾‹åŒ–çš„å¯¹è±¡å»è°ƒç”¨ çˆ¶ç±»æ–¹æ³• start å³å¯.

æ³¨æ„, å¤šæ¬¡å¯ç”¨ä¸€ä¸ªçº¿ç¨‹æ˜¯éæ³•çš„ !!!

~~~java
public static void main(String args[]){
    
    MyThread t1 = new MyThread();
    
    /*
    	æ³¨æ„startçš„ä½œç”¨æ˜¯ : 
    	å¯¼è‡´æ­¤çº¿ç¨‹å¼€å§‹æ‰§è¡Œ; Javaè™šæ‹Ÿæœºè°ƒç”¨æ­¤çº¿ç¨‹çš„runæ–¹æ³•ã€‚
    */
    t1.start()
        
    // å¤šæ¬¡å¯ç”¨ä¸€ä¸ªçº¿ç¨‹æ˜¯éæ³•çš„ âŒ
	// æ³¨æ„æ¬¡ç§æƒ…å†µä¼šæŠ›å‡ºå¼‚å¸¸ (ä¸»çº¿ç¨‹ç§æŠ›å‡ºçš„!!!!) 
    // t1.start()
        
    /*
    	å¦‚æœæˆ‘ä»¬ç›´æ¥ä»¥æˆå‘˜æ–¹æ³•çš„å½¢å¼è°ƒç”¨ run, é‚£ä¹ˆç»“æœå¹¶ä¸ä¼šä»¥å¤šçº¿ç¨‹çš„å½¢å¼è¡¨ç°
    	å’Œæ™®é€šçš„å¯¹è±¡æ–¹æ³•è°ƒç”¨æ— å¼‚
    */
    t1.run()
}
~~~



#### ğŸŒŸ å®ç° Runnable æ¥å£çš„æ–¹å¼ä½¿ç”¨çº¿ç¨‹

~~~java
/*
	æˆ‘ä»¬å¯ä»¥è®©ä¸€ä¸ªç±»ç»§æ‰¿ä¸€ä¸ª Runnable æ¥å£
	ç„¶ååœ¨æ–°ç±»ä¸­å®ç° Runnable çš„ runæ–¹æ³•å³å¯
*/
public class MyThread implements Runnable{
    public viod run(){
        // code ...
    }
}

// ä¸»ç¨‹åºä¸­ç”¨è°ƒç”¨
public static void main(String[] args){
    
    // å…ˆå£°æ˜ä¸€ä¸ªæˆ‘ä»¬çš„å¯¹è±¡
    MyThread mt = new MyThread();
    
    // ç„¶ååˆ©ç”¨ Thread çš„æ„é€ å‡½æ•°, å»å®ç°ä¸€ä¸ª runnable çš„ä¼ å‚
    Thread t1 = new Thread(mt);
    
    // å†è¿›è¡Œstartçš„æ—¶å€™, è¯¥çº¿ç¨‹ä¾¿æ˜¯ç›´æ¥è°ƒç”¨çš„ mt çš„ run æ–¹æ³•
    t1.start();
}
~~~











#### å®ç° Callable æ¥å£çš„æ–¹å¼ä½¿ç”¨çº¿ç¨‹

~~~java
/*

*/
public class MyThread implements Callable{
    public viod run(){
        // code ...
    }
}

// ä¸»ç¨‹åºä¸­ç”¨ 
~~~



#### å®ç°æ¥å£ VS ç»§æ‰¿ Thread

ğŸŒŸ å®ç°æ¥å£çš„æ–¹æ³•æ›´å¥½, å› ä¸º :

* Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œå› æ­¤ç»§æ‰¿äº† Thread ç±»å°±æ— æ³•ç»§æ‰¿å…¶å®ƒç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£
* ç±»å¯èƒ½åªè¦æ±‚å¯æ‰§è¡Œå°±è¡Œï¼Œ**ç»§æ‰¿æ•´ä¸ª Thread ç±»å¼€é”€è¿‡å¤§**







### çº¿ç¨‹åç§°

æŸ¥çœ‹ä¸€ä¸ª **çº¿ç¨‹çš„åç§°(å­—ç¬¦ä¸²)** çš„æ–¹æ³• : 

æ³¨æ„è¿™ä¸ªçº¿ç¨‹ç±»ä¸ä¸€å®šè¢«å¼€å¯äº†.

~~~java
/*
	getName() æ–¹æ³•
	çº¿ç¨‹åç§°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¼ é€’
    * å¦‚æœåœ¨æ„é€ å‡½æ•°ä¼ é€’äº†è‡ªå®šä¹‰å­—ç¬¦ä¸², åˆ™çº¿ç¨‹è¢«å‘½åä¸ºè¯¥å­—ç¬¦ä¸²
    * å¦‚æœæ²¡æœ‰ä¼ é€’, é‚£ä¹ˆçº¿ç¨‹è°ƒç”¨é»˜è®¤çš„å‘½å e.g. "Thread-0"
*/
class MyThread extends Thread{
    MyThread(String name){
        super(name)
    }
}

public static void main(String args[]){
    MyThread t1 = new MyThread("FangZhou");
    
    // è·å¾—çº¿ç¨‹åç§°
    // æ³¨æ„, è¿™ä¸ªçº¿ç¨‹çš„åç§°, æ˜¯ä¸€æ—¦å®ä¾‹åŒ–å°±è¢«åˆ†é…åˆ°çš„, ä¸ç®¡è¿™ä¸ªçº¿ç¨‹æœ‰æ²¡æœ‰å¼€å¯ (strat)
    t1.getName();
}

~~~





<hr>

æŸ¥çœ‹ä¸€ä¸ª **æ­£åœ¨è¿è¡Œ(å·²ç»è¢«å¼€å¯)** çš„çº¿ç¨‹ç±»çš„åç§°:

~~~java
/*
	currentThread() æ–¹æ³•
	è¿™ä¸ªæ˜¯ä¸€ä¸ªé™æ€çš„æ–¹æ³•, å¯ä»¥è¿”å›å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹çš„å¯¹è±¡å¼•ç”¨
*/
class MyThread extends Thread{
    public void run(){
        // code...
    }
}

public static void main(String args[]){
    MyThread t1 = new MyThread("FangZhou");
    
    // æ‰“å°å‡º main
	System.out.println(Thread.currentThread().getName());
}
~~~



## ä¸‰. çº¿ç¨‹è¿è¡ŒçŠ¶æ€

~~~java
/*
	runable <=> TimeWaiting è°ƒç”¨sleep(time)å‡½æ•°, timeè§„å®šäº†ç¡çœ æ—¶é—´, æ—¶é—´åˆ°äº†çº¿ç¨‹è‡ªåŠ¨å˜ä¸ºè¿è¡Œæ€
	runable <=> waiting 
				è°ƒç”¨ wait() å‡½æ•°, è®©çº¿ç¨‹è¿›å…¥ waiting æ€, ä¸”ä¸ä¼šè‡ªåŠ¨åˆ‡å›
				è°ƒç”¨ notify() , è®©çº¿ç¨‹å¯ä»¥ä» waiting æ€åˆ‡å› è¿è¡Œæ€
*/
~~~



<img src = '../image/2019-07-20-thread-status.png' />

### æ–°å»º New

åˆ›å»ºäº†çº¿ç¨‹åè¿˜æœªå¯åŠ¨

<hr>

### å¯è¿è¡Œæ€ Runnable

* å¯èƒ½æ­£åœ¨è¿è¡Œ
* å¯èƒ½æ­£åœ¨ç­‰å¾…CPUåˆ†é…æ—¶é—´ç‰‡

å¯å¯¹åº”äºCPUçš„ä¸¤ç§çº¿ç¨‹çŠ¶æ€ : Ready , Running

<hr>

### é˜»å¡ (Blocked)

çº¿ç¨‹éœ€è¦ç­‰å¾…ä¸€ä¸ªç³»ç»Ÿçš„èµ„æº(e.g. I/O) è¢«é‡Šæ”¾, æ‰èƒ½ç»§ç»­çš„è¿è¡Œ

<hr>

### æ— é™ç­‰å¾…çŠ¶æ€ (Waiting)

é™¤éå…¶ä»–çº¿ç¨‹æ˜¾ç¤ºçš„è¿›è¡Œå”¤é†’ (notify) , å¦åˆ™ä¸ä¼šè¢«åˆ†é…CPUçš„æ—¶é—´ç‰‡

<hr>

### é™æœŸç­‰å¾… (Timed Waiting)

ä¸éœ€è¦è¢«æ˜¾ç¤ºçš„å”¤é†’, åœ¨ä¸€å®šæ—¶é—´è¿‡åè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’

<hr>

### æ­»äº¡ (Terminated)

çº¿ç¨‹æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥èµ°å‘æ¶ˆäº¡ â˜ ï¸

* å®Œæˆä»»åŠ¡è‡ªç„¶ç»“æŸ
* é‡åˆ°å¼‚å¸¸è€Œç»“æŸ

<hr>


## å››. å–ç¥¨é—®é¢˜

åˆ©ç”¨å®ç° runnable æ¥å£, å®ç°å¯¹ **ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ (Ticket)** çš„å¤šçº¿ç¨‹è¿è¡Œé—®é¢˜.  **ä»è€Œå®ç°å¤šä¸ªçº¿ç¨‹è¿è¡Œçš„è¿‡ç¨‹ä¸­, èµ„æºä¸ºåŒä¸€ä¸ª (å®ä¾‹åŒ–å¯¹è±¡). è€Œä¸éœ€è¦å°†çº¿ç¨‹å…±äº«çš„èµ„æºå£°æ˜ä¸ºé™æ€èµ„æº**

ä¹Ÿå°±æ˜¯è¯´, ä½¿ç”¨ `runnable`æ¥å£åªæœ‰ `run` æ–¹æ³•é‡Œé¢è¢«å¤šçº¿ç¨‹è°ƒç”¨, å±äºå„ä¸ªçº¿ç¨‹ç§æœ‰, ä½†æ˜¯è¯¥ç±»çš„æˆå‘˜å˜é‡ å¦‚ `ticket_num` ä»ç„¶æ˜¯å¤šä¸ªçº¿ç¨‹å…±æœ‰



~~~java
class Ticket implements Runnable{
	private ticket_num = 100;
    public void run(){
        while(true){
            if(num < 0){
                Sale_Ticket();
            }
        }
    }
}

public static void main(String[] args){
    Ticket Tick_Impls = new Ticket();
    
    // Runnableå¯¹è±¡ä½œä¸ºä¼ å‚æ•°çš„æ„é€ çº¿ç¨‹
	Thread t1 = new Thread(Tick_Impls);
    Thread t2 = new Thread(Tick_Impls);
    Thread t3 = new Thread(Tick_Impls);
    Thread t4 = new Thread(Tick_Impls);
    
    // è¿è¡Œ
    // æ­¤æ—¶ t1, t2, t3, t4 å…±äº«ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡çš„èµ„æº
    t1.start();
    t2.start();
    t3.start();
    t4.start();   
}

~~~



<hr>

**å¯èƒ½å‡ºç°çš„é—®é¢˜ :** 

åœ¨å¤šçº¿ç¨‹çš„ä½¿ç”¨æ—¶, æˆ‘ä»¬å¿…é¡»å»è€ƒè™‘ä¸€ä¸‹çº¿ç¨‹çš„å®‰å…¨é—®é¢˜

æ¯”å¦‚è¿™ä¸ªå°ä¾‹å­, å”®å‡ºçš„ç¥¨å¯èƒ½å‡ºç°è´Ÿæ•°çš„æƒ…å†µ, ä»è€Œå¯¼è‡´ä¸¥é‡ç¾éš¾

<img src = '../image/2019-07-20-thread-insecure.svg' />





## äº”. çº¿ç¨‹å®‰å…¨

### äº§ç”Ÿå®‰å…¨é—®é¢˜å‰æ

å¤šçº¿ç¨‹å¯èƒ½äº§ç”Ÿå®‰å…¨é—®æçš„å‰æ :

1. **å¤šä¸ªçº¿ç¨‹** åœ¨æ“ä½œä¸€ä¸ª **å…±äº«æ•°æ®**
2. æ“ä½œå…±äº«æ•°æ®çš„ä»£ç æœ‰ **å¤šæ¡** , å› ä¸ºå¦‚æœåªæœ‰ä¸€æ¡çš„è¯, ä¸€ä¸ªçº¿ç¨‹åªæœ‰åœ¨è¿™ä¸ªè¯­å¥æ‰§è¡Œå‰åæ‰å¯èƒ½å‡ºç°é˜»å¡. æ‰€ä»¥è¿˜æ˜¯å‰åä¸€è‡´çš„



### è¿›ç¨‹åŒæ­¥ (synchronized)

å°†æ“ä½œå…±äº«æ•°æ®çš„ä¸€æ®µä»£ç è§†ä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“, å³è®©è¿™ä¸€æ®µä»£ç å…·æœ‰åŸå­è¡Œ, ä»è€Œå½“ä¸€ä¸ªçº¿ç¨‹æ“ä½œ å…±äº«æ•°æ®çš„æ—¶å€™, è¢«çš„çº¿ç¨‹æ— æ³•è¿›å…¥ä¸´ç•ŒåŒº.

åŒæ­¥å…³é”®å­—, å¯ä»¥å®šä¹‰ä¸€ä¸ª : 

1. åŒæ­¥ä»£ç å— : å¤„äºè¿™ä¸ªä»£ç å—é‡Œçš„ä»£ç , å¯ä»¥è®©çº¿ç¨‹æ“ä½œè¯¥ä»£ç å—çš„æ—¶å€™, å¯¹è¿™ä¸ªä»£ç å—è¿›è¡Œä¸Šé”. 

2. åŒæ­¥å‡½æ•° : ç›´æ¥å°†å‡½æ•°å£°æ˜ä¸ºåŒæ­¥çš„


#### ğŸŒŸ åŒæ­¥ä»£ç å—

~~~java
/*
	ä¼ é€’çš„å¯¹è±¡ obj å£°æ˜æˆ object ç±»å³å¯
	å¯ä»¥å°† obj çœ‹æˆæ˜¯ä¸€ä¸ª åŒæ­¥é”
    synchronized (obj){
		
		// thread operator shared resource
	
    }
*/

class Ticket implements Runnable{
	private ticket_num = 100;
    object obj = new object();
    public void run(){
        while(true){
            synchronized (obj){
                // operator shared resource
                if(num < 0){
                    Sale_Ticket();
                }
            }
        }        
    }
}
~~~



**åŒæ­¥ä»£ç å—ä¸‹éœ€è¦æ³¨æ„çš„å‰æ :**

åŒæ­¥è¿‡ç¨‹ä¸­, æ‰€æœ‰çš„çº¿ç¨‹å¿…é¡»ä½¿ç”¨åŒä¸€ä¸ªé” ğŸ”’ , ä¹Ÿå°±æ˜¯è¯´, é”å¯¹è±¡ object å¿…é¡»æ˜¯å…¨å±€çš„, è€Œä¸æ˜¯å±€éƒ¨çš„

```java
class Ticket implements Runnable{
	private ticket_num = 100;
    public void run(){
        // âŒ ä¸èƒ½å°†è¿™ä¸ªé”å£°æ˜ä¸ºå±€éƒ¨çš„
        object obj = new object();
        while(true){
            synchronized (obj){
                // operator shared resource
                if(num < 0){
                    Sale_Ticket();
                }
            }
        }        
    }
}
```



#### åŒæ­¥å‡½æ•°

~~~java
class bank{
    private num = 0;
/*
	ç”¨ synchronized ä¿®é¥°å‡½æ•°, å¯ä»¥ä¸ç”¨å†å»å®šä¹‰ä¸€ä¸ªobjå¯¹è±¡é”
    ä½†æ˜¯æ³¨æ„åŒæ­¥å‡½æ•°, ä¾¿è§„å®šäº†åŒæ­¥èŒƒå›´, ä¸”è¯¥å‡½æ•°å†…çš„è¯­å¥å…¨éƒ¨è¢«åŒæ­¥
    æ‰€ä»¥åŒæ­¥çš„æ—¶å€™, éœ€è¦æ³¨æ„åŒæ­¥èŒƒå›´
*/
/*
	ä½¿ç”¨åŒæ­¥å‡½æ•°çš„æ—¶å€™, ç”¨çš„é”æ˜¯å›ºå®šçš„
	å³ä¸º this, å°±æ˜¯è¿™ä¸ªä»£ç å—çš„è°ƒç”¨å¯¹è±¡
*/
    
    public synchronized void add(int i){
        sum = sum + i;
        System.out.println("your blance is :" + num);
    }
}

/*
	è¡¨é¢çœ‹èµ·æ¥ run å‡½æ•°åªæœ‰ä¸€ä¸ªè¯­å¥, ä¸ç¬¦åˆäº§ç”Ÿå®‰å…¨æ€§å‰æ. 
	ä½†æ˜¯ add ç¡®å®ä¸€ä¸ªå‡½æ•°, å‡½æ•°çš„å†…å®¹ä¹Ÿåº”è¯¥æ˜¯çº¿ç¨‹å…±äº«çš„ä¸€éƒ¨åˆ†
	æ‰€ä»¥è¿˜æ˜¯æœ‰å®‰å…¨æ€§é—®é¢˜å‘ç”Ÿçš„å¯èƒ½.
*/

class cust implements Runnable{
    bank b = new bank();
    
    public run(){
        for(int i=0; i<3; i++){
            b.add(100);
        }
    }
}

public static void main(String[] args[]){
    Cust c = new Cust();
    Thread t = new Thread(c);
    
    // start thread
    t.start();
}
~~~



#### åŒæ­¥å‡½æ•° å’Œ åŒæ­¥ä»£ç å—çš„åŒºåˆ«

åŒæ­¥ä»£ç å—çš„é”æ˜¯ä»»æ„çš„å¯¹è±¡

åŒæ­¥å‡½æ•°çš„é”æ˜¯å›ºå®šçš„ this

<hr>

å¦‚æœ åŒæ­¥å‡½æ•°çš„ä¸º **é™æ€çš„å‡½æ•°**, æ­¤æ—¶åŒæ­¥å‡½æ•°çš„ **é”ä¾¿ä¸æ˜¯ this** (é™æ€å‡½æ•°é‡Œé¢æ²¡æœ‰ this)

~~~java
/*
	æ­¤æ—¶åŒæ­¥å‡½æ•°çš„é”ğŸ”’ 
	æ˜¯è¿™ä¸ªå¯¹è±¡çš„é”æ˜¯å¯¹è±¡ä¸º: è¯¥å¯¹è±¡çš„å­—èŠ‚ç å¯¹è±¡
	this.getClass()
*/
public static synchronized void add(int i){
    sum = sum + i;
    System.out.println("your blance is :" + num);
}
~~~



### åŒæ­¥å¼Šç«¯

åŒæ­¥è™½ç„¶ä¼šè§£å†³ä¸€éƒ¨åˆ†çš„å®‰å…¨æ€§çš„é—®é¢˜, ä½†æ˜¯ä¼šé™ä½ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡





### å¤šçº¿ç¨‹ä¸‹å•ä¾‹è®¾è®¡æ¨¡å¼çš„å®‰å…¨éšæ‚£

è§è®¾è®¡æ¨¡å¼ç¬”è®°



###æ­»é”

æ­»é”å°±æ˜¯, ä¸¤ä¸ªåŠä»¥ä¸Šçš„çº¿ç¨‹, ç›¸äº’æŒæœ‰å¯¹æ–¹è¦è¿è¡Œæ—¶çš„èµ„æº, ä¸”éƒ½ä¸é‡Šæ”¾è‡ªæœ‰èµ„æºçš„æƒ…å†µ, è¿™ç§æƒ…å†µ, ç›¸äº’æŒæœ‰èµ„æºçš„çº¿ç¨‹è¢«æ­»é”.

æ­»é”å‘ç”Ÿçš„å‰æ :

1. è‡³å°‘æœ‰ **ä¸¤ä¸ªå³ä»¥ä¸Šçš„ å…±äº«é”**
2. é”çš„åˆ©ç”¨ä¸Šæœ‰ **ç›¸äº’åµŒå¥—** çš„æƒ…å†µ



<hr>

~~~java
/*
	ä¸€ä¸ªæ­»é”çš„ä¾‹å­
*/
package MutiThread;
class locker{

    public static final Object lockerA= new Object();
    public static final Object lockerB= new Object();

}

class DeadLock implements Runnable{

    public boolean flag;
    public DeadLock(boolean flag){
        this.flag = flag;
    }
    @Override
    public void run() {
        if(flag){
            while(true) {
                synchronized (locker.lockerA) {
                    synchronized (locker.lockerB) {
                        System.out.println("hello : " + Thread.currentThread().getName());
                    }
                }
            }

        }else{
            while (true) {
                synchronized (locker.lockerB) {
                    synchronized (locker.lockerA) {
                        System.out.println("hello : " + Thread.currentThread().getName());
                    }
                }
            }
        }
    }
}


public class DeadLockDemo {
    public static void main(String[] args){
        DeadLock d = new DeadLock(true);
        DeadLock d2 = new DeadLock(false);
        Thread t1 = new Thread(d);
        Thread t2 = new Thread(d2);

        t1.start();
        t2.start();

    }
~~~





## å…­. çº¿ç¨‹ä¹‹é—´çš„åä½œ

å½“å¤šä¸ªçº¿ç¨‹å¯ä»¥ä¸€èµ·å·¥ä½œå»è§£å†³æŸä¸ªé—®é¢˜æ—¶ï¼Œå¦‚æœ **æŸäº›éƒ¨åˆ†å¿…é¡»åœ¨å…¶å®ƒéƒ¨åˆ†ä¹‹å‰å®Œæˆ**ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹**çº¿ç¨‹è¿›è¡Œåè°ƒ**ã€‚

æ³¨æ„ çº¿ç¨‹åä½œ ä¸åŒäº çº¿ç¨‹äº’æ–¥ .

**çº¿ç¨‹äº’æ–¥** æ›´å¤šçš„æ˜¯ä¿è¯çº¿ç¨‹ä¹‹é—´ä¸è¢«å½¼æ­¤å¹²æ‰°

**çº¿ç¨‹åè°ƒ** æ˜¯å¼ºè°ƒå½¼æ­¤ä¹‹é—´çš„åè°ƒ, çº¿æ€§ä¹‹é—´å­˜åœ¨å·¥ä½œçš„æ¬¡åºæ€§
































