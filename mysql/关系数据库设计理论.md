[TOC]

# 一. 关系数据库设计理论




## 函数依赖

记 A->B 表示 A 函数决定 B，也可以说 B 函数依赖于 A。

functional dependency A → B is valid in a  relational table R or that A functionally determines B 

<hr>

假设  X, Y, Z be the nonempty subsets of {A1, ..., An}

我们有如下的结论 :

* If Y ⊆ X then X → Y (reflexivity axiom) 如果 Y 属于 X 那么 

* If X → Y then X, Z → Y, Z (augmentation axiom), 如果 X 确定 Y, 那么 X, Z 确定 Y. Z
* If X → Y and Y → Z then X → Z (transitivity axiom 传递函数依赖) 



<hr>

完全函数依赖 ( fully functionally dependent) 和 部分函数依赖 :

对于 A->B，如果能找到 A 的真子集 A'，使得 A'-> B，那么 A->B 就是 **部分函数依赖**，否则就是 **完全函数依赖**

简单来说 A -> B 中 A是一个最小的集合, 那么 A对B就是完全函数依赖



<hr>

**如何确定 键码 :**

如果 {A1，A2，... ，An} 是关系的一个或多个属性的 **集合** ，该集合函数 **决定了关系的其它所有属性** 并且是**最小的**，那么该集合就称为 **键码**

即 如果 X 为 R 的一个子集, 且如果 X 可以决定 R的其他所有的属性, 且 X 为最小的子集, 我们有, X 为 R的一个键码



## 异常

以下展现一个 **不符合范式** 设计的数据表可能出现的问题 

以下的学生课程关系的函数依赖为 {Sno, Cname} -> {Sname, Sdept, Mname, Grade} 即

**键码为 {Sno, Cname}**。也就是说，确定学生和课程之后，就能确定其它信息。

| Sno  | Sname  | Sdept  | Mname  | Cname  | Grade |
| ---- | ------ | ------ | ------ | ------ | ----- |
| 1    | 学生-1 | 学院-1 | 院长-1 | 课程-1 | 90    |
| 2    | 学生-2 | 学院-2 | 院长-2 | 课程-2 | 80    |
| 2    | 学生-2 | 学院-2 | 院长-2 | 课程-1 | 100   |
| 3    | 学生-3 | 学院-2 | 院长-2 | 课程-2 | 95    |

- 冗余数据：例如 `学生-2` 出现了两次。
- 修改异常：修改了一个记录中的信息，但是另一个记录中相同的信息却没有被修改。
- 删除异常：删除一个信息，那么也会丢失其它信息。例如删除了 `课程-1` 需要删除第一行和第三行，那么 `学生-1` 的信息就会丢失。
- 插入异常：例如想要插入一个学生的信息，如果这个学生还没选课，那么就无法插入。





## 范式 (Normal Form) 

范式的提出是为了解决以上的四种异常.

高级别范式的依赖于低级别的范式，1NF 是最低级别的范式。



### INF (第一范式)

第一范式要求, 我们设计的表的字段都是具有 **原子性**, 即表字段不可再分

例如 : 

| name | address                                  |
| ---- | ---------------------------------------- |
| fz   | \| Country\| Province \|City\|Stresst \| |

字段 address 又可以被分为 下面的四个字段 | Country| Province | City | Stresst | 

所以此时这个 字段不符合 **原子性**

这个表不符合 1NF (不符合 1NF 的表通常被称为 0NF)

**注意, 符合1NF 仅仅是数据表设计的最基本的要求, 满足 1NF 仍然会有很多问题出现, 比如上面的例子表就符合1NF的要求**





### 2NF (第二范式)

第二范式要求 : 我们的设计的表的 **非主属性** 完全依赖函数于 **主属性 (主键)**

完全函数依赖的概念再复习一遍 : 

~~~
已知 A , B 且 A -> B.

如果存在 A' 为 A 的一个真子集, 且 A' -> B, 那么我们说, A, B为部分函数依赖

否则为完全函数依赖
~~~

以上的 表设计举例, 我们有如下的 依赖关系 :

{Sno, Cname} -> {Sname, Sdept, Mname, Grade} 

且 观察表我们可以发现, 还有如下的依赖关系 :

Sno -> Sname, Sdept







### 3NF (第三范式)

没有传递依赖







### BCNF







































